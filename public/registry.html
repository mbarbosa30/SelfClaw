<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Tokens | SelfClaw</title>
  <meta name="description" content="Live prices, market caps, and 24h charts for AI agent tokens on Celo. Powered by verified human identities and Uniswap V4 liquidity.">
  <link rel="canonical" href="https://selfclaw.ai/registry">

  <meta property="og:type" content="website">
  <meta property="og:url" content="https://selfclaw.ai/registry">
  <meta property="og:title" content="Agent Tokens | SelfClaw">
  <meta property="og:description" content="Live prices, market caps, and 24h charts for AI agent tokens on Celo.">
  <meta property="og:image" content="https://selfclaw.ai/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="675">
  <meta property="og:site_name" content="SelfClaw">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@mbarrbosa">
  <meta name="twitter:title" content="Agent Tokens | SelfClaw">
  <meta name="twitter:description" content="Live prices, market caps, and 24h charts for AI agent tokens on Celo.">
  <meta name="twitter:image" content="https://selfclaw.ai/og-image.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    .listing-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 1.5rem;
    }
    .listing-header h1 {
      font-size: 1.5rem;
      margin: 0;
    }
    .listing-meta {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .selfclaw-ref {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      padding: 0.75rem 1rem;
      border: 2px solid var(--border-light);
      font-family: var(--font-mono);
      font-size: 0.75rem;
      flex-wrap: wrap;
    }
    .ref-item { color: var(--text-muted); }
    .ref-value { color: var(--text-primary); font-weight: 600; }

    .token-table {
      width: 100%;
      border-collapse: collapse;
    }
    .token-table th {
      font-family: var(--font-mono);
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      padding: 0.5rem 0.75rem;
      text-align: right;
      border-bottom: 2px solid var(--border-heavy);
      white-space: nowrap;
    }
    .token-table th:first-child,
    .token-table th:nth-child(2) { text-align: left; }
    .token-table td {
      padding: 0.75rem;
      border-bottom: 1px solid var(--border-light);
      font-family: var(--font-mono);
      font-size: 0.85rem;
      text-align: right;
      vertical-align: middle;
    }
    .token-table td:first-child { text-align: center; color: var(--text-muted); font-size: 0.75rem; width: 2rem; }
    .token-table td:nth-child(2) { text-align: left; font-family: var(--font-body); }
    .token-table tbody tr { transition: background 0.1s; cursor: pointer; }
    .token-table tbody tr:hover { background: var(--border-light); }

    .token-identity {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }
    .token-icon {
      width: 32px;
      height: 32px;
      border: 2px solid var(--border-heavy);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.85rem;
      flex-shrink: 0;
      background: var(--bg);
    }
    .token-name-group { min-width: 0; }
    .token-name {
      font-weight: 600;
      font-size: 0.9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .token-symbol-sub {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--text-muted);
      text-transform: uppercase;
    }
    .token-agent-name {
      font-size: 0.65rem;
      color: var(--text-muted);
      font-family: var(--font-mono);
    }
    .price-cell { font-weight: 600; }
    .change-positive { color: #16a34a; }
    .change-negative { color: #dc2626; }
    .change-neutral { color: var(--text-muted); }
    .mcap-cell { color: var(--text-primary); }
    .sparkline-cell { width: 120px; padding: 0.5rem 0.75rem; }
    .sparkline-canvas { display: block; }
    .links-cell {
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      white-space: nowrap;
    }
    .links-cell a {
      color: var(--accent);
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: border-color 0.15s;
    }
    .links-cell a:hover { border-bottom-color: var(--accent); }

    .listing-empty {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-muted);
      font-family: var(--font-mono);
      font-size: 0.85rem;
    }
    .listing-loading {
      text-align: center;
      padding: 3rem 1rem;
      color: var(--text-muted);
      font-family: var(--font-mono);
      font-size: 0.85rem;
    }

    @media (max-width: 768px) {
      .token-table th:nth-child(5),
      .token-table td:nth-child(5) { display: none; }
      .selfclaw-ref { gap: 0.75rem; }
      .listing-header { flex-direction: column; gap: 0.25rem; }
    }
    @media (max-width: 600px) {
      .token-table th:nth-child(4),
      .token-table td:nth-child(4),
      .token-table th:nth-child(6),
      .token-table td:nth-child(6) { display: none; }
      .token-icon { width: 28px; height: 28px; font-size: 0.75rem; }
      .token-name { font-size: 0.8rem; }
      .token-table td { padding: 0.5rem 0.4rem; font-size: 0.8rem; }
      .token-table th { padding: 0.4rem; }
    }
  </style>
</head>
<body>
  <div class="site-container">
    <header class="site-header">
      <a href="/" class="site-logo"><img src="/claw-icon.svg" alt="" class="site-logo-icon">SELFCLAW</a>
      <button class="nav-toggle" aria-label="Menu">&equiv;</button>
      <nav class="site-nav">
        <a href="/verify" class="nav-link">VERIFY</a>
        <a href="/registry" class="nav-link nav-link-active">AGENTS</a>
        <a href="/dashboard" class="nav-link" data-gate style="display:none">DASHBOARD</a>
        <a href="/developers" class="nav-link">DOCS</a>
        <a href="/whitepaper" class="nav-link">WHITEPAPER</a>
        <a href="/manifesto" class="nav-link">\\\</a>
      </nav>
    </header>

    <section style="margin-top: 2rem;">
      <div class="listing-header">
        <h1>Agent Token Prices</h1>
        <div class="listing-meta" id="listing-meta"></div>
      </div>

      <div class="selfclaw-ref" id="ref-prices" style="display:none;">
        <span class="ref-item">SELFCLAW <span class="ref-value" id="ref-selfclaw">-</span></span>
        <span class="ref-item">CELO <span class="ref-value" id="ref-celo">-</span></span>
      </div>

      <div id="listing-container">
        <div class="listing-loading">Loading token data...</div>
      </div>
    </section>

    <footer class="site-footer">
      <nav class="footer-nav">
        <a href="/">Home</a>
        <a href="/verify">Verify</a>
        <a href="/registry" data-gate-footer style="display:none">Agents</a>
        <a href="/dashboard" data-gate-footer style="display:none">Dashboard</a>
        <a href="/economy">Economy</a>
        <a href="/guide">Guide</a>
        <a href="/developers">Docs</a>
        <a href="/whitepaper">Whitepaper</a>
      </nav>
      <div class="footer-meta">
        <span>Powered by <a href="https://self.xyz" target="_blank">Self.xyz</a> zero-knowledge proofs</span>
        <span>Built by <a href="https://zeno.vision" target="_blank" rel="noopener">Zeno</a> · <a href="https://github.com/mbarbosa30/SelfClaw" target="_blank" rel="noopener">GitHub</a> · <a href="https://t.me/+GC2quXBnarw1MzU0" target="_blank" rel="noopener">Telegram</a> &middot; <a href="https://x.com/selfclaw" target="_blank" rel="noopener">X</a></span>
      </div>
    </footer>
  </div>

  <script src="app.js"></script>
  <script>
    function esc(t) {
      if (!t) return '';
      var d = document.createElement('div');
      d.textContent = t;
      return d.innerHTML;
    }

    function drawSparkline(canvas, data, isPositive) {
      if (!data || data.length < 2) return;
      var ctx = canvas.getContext('2d');
      var w = canvas.width = 120;
      var h = canvas.height = 32;
      var dpr = window.devicePixelRatio || 1;
      canvas.width = w * dpr;
      canvas.height = h * dpr;
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      ctx.scale(dpr, dpr);

      var min = Math.min.apply(null, data);
      var max = Math.max.apply(null, data);
      var range = max - min || 1;
      var pad = 2;

      ctx.beginPath();
      ctx.strokeStyle = isPositive ? '#16a34a' : '#dc2626';
      ctx.lineWidth = 1.5;
      ctx.lineJoin = 'round';

      for (var i = 0; i < data.length; i++) {
        var x = pad + (i / (data.length - 1)) * (w - pad * 2);
        var y = h - pad - ((data[i] - min) / range) * (h - pad * 2);
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();
    }

    async function loadTokenListings() {
      var container = document.getElementById('listing-container');
      try {
        var res = await fetch('/api/selfclaw/v1/token-listings', { credentials: 'include' });
        if (!res.ok) throw new Error('Failed to load');
        var data = await res.json();
        var tokens = data.tokens || [];

        if (data.reference) {
          document.getElementById('ref-prices').style.display = '';
          document.getElementById('ref-selfclaw').textContent = '$' + (data.reference.selfclawUsd || 0).toFixed(6);
          document.getElementById('ref-celo').textContent = '$' + (data.reference.celoUsd || 0).toFixed(4);
        }

        document.getElementById('listing-meta').textContent = tokens.length + ' tokens with liquidity';

        if (tokens.length === 0) {
          container.innerHTML = '<div class="listing-empty">No agent tokens with active liquidity pools yet.<br><a href="/verify">Verify your agent and deploy a token.</a></div>';
          return;
        }

        var html = '<table class="token-table"><thead><tr>';
        html += '<th>#</th>';
        html += '<th>Token</th>';
        html += '<th>Price</th>';
        html += '<th>24h %</th>';
        html += '<th>Market Cap</th>';
        html += '<th>Last 24h</th>';
        html += '<th></th>';
        html += '</tr></thead><tbody>';

        tokens.forEach(function(t) {
          var changeClass = t.change24h > 0 ? 'change-positive' : t.change24h < 0 ? 'change-negative' : 'change-neutral';
          var changePrefix = t.change24h > 0 ? '+' : '';
          var letter = (t.tokenName || t.tokenSymbol || '?').charAt(0).toUpperCase();
          var rowUrl = t.profileUrl || t.celoscanUrl;
          var agentLabel = t.agentName ? '<div class="token-agent-name">' + esc(t.agentName) + '</div>' : '';

          html += '<tr onclick="window.location.href=\'' + esc(rowUrl) + '\'">';
          html += '<td>' + t.rank + '</td>';
          html += '<td><div class="token-identity">';
          html += '<div class="token-icon">' + letter + '</div>';
          html += '<div class="token-name-group">';
          html += '<div class="token-name">' + esc(t.tokenName) + '</div>';
          html += '<div class="token-symbol-sub">$' + esc(t.tokenSymbol) + '</div>';
          html += agentLabel;
          html += '</div></div></td>';
          html += '<td class="price-cell">$' + esc(t.priceFormatted) + '</td>';
          html += '<td class="' + changeClass + '">' + changePrefix + t.change24h.toFixed(2) + '%</td>';
          html += '<td class="mcap-cell">' + esc(t.marketCapFormatted) + '</td>';
          html += '<td class="sparkline-cell"><canvas class="sparkline-canvas" data-sparkline=\'' + JSON.stringify(t.sparkline || []) + '\' data-positive="' + (t.change24h >= 0 ? '1' : '0') + '"></canvas></td>';
          html += '<td class="links-cell"><a href="' + esc(t.uniswapUrl) + '" target="_blank" rel="noopener" onclick="event.stopPropagation()">Pool</a> · <a href="' + esc(t.celoscanUrl) + '" target="_blank" rel="noopener" onclick="event.stopPropagation()">Token</a></td>';
          html += '</tr>';
        });

        html += '</tbody></table>';
        container.innerHTML = html;

        document.querySelectorAll('.sparkline-canvas').forEach(function(canvas) {
          try {
            var sparkData = JSON.parse(canvas.getAttribute('data-sparkline') || '[]');
            var isPos = canvas.getAttribute('data-positive') === '1';
            drawSparkline(canvas, sparkData, isPos);
          } catch(e) {}
        });

      } catch (error) {
        console.error('Failed to load token listings:', error);
        container.innerHTML = '<div class="listing-empty">Failed to load token data. Please try again.</div>';
      }
    }

    loadTokenListings();
  </script>
  <script src="/auth.js"></script>
  <script src="/nav-gate.js"></script>
  <script src="/nav-toggle.js"></script>
</body>
</html>
