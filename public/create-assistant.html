<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Assistant | SelfClaw</title>
  <meta name="description" content="Create a lightweight AI assistant that runs on SelfClaw's infrastructure. No coding required.">
  <link rel="canonical" href="https://selfclaw.ai/create-assistant">

  <meta property="og:type" content="website">
  <meta property="og:url" content="https://selfclaw.ai/create-assistant">
  <meta property="og:title" content="Create Assistant | SelfClaw">
  <meta property="og:description" content="Create a lightweight AI assistant that runs on SelfClaw's infrastructure. No coding required.">
  <meta property="og:image" content="https://selfclaw.ai/og-image.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="675">
  <meta property="og:site_name" content="SelfClaw">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@mbarrbosa">
  <meta name="twitter:title" content="Create Assistant | SelfClaw">
  <meta name="twitter:description" content="Create a lightweight AI assistant that runs on SelfClaw's infrastructure. No coding required.">
  <meta name="twitter:image" content="https://selfclaw.ai/og-image.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <style>
    .create-page { max-width: 800px; margin: 0 auto; padding: 0 var(--space-md); }

    .wizard-steps {
      display: flex; gap: 0; margin-bottom: var(--space-lg);
      border: 2px solid var(--border-heavy);
    }
    .wizard-step {
      flex: 1; padding: 0.75rem 0.5rem; text-align: center;
      font-family: var(--font-mono); font-size: 0.65rem; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.06em;
      color: var(--text-muted); background: var(--bg-card);
      border-right: 2px solid var(--border-heavy);
      transition: all 0.2s;
    }
    .wizard-step:last-child { border-right: none; }
    .wizard-step.active { background: var(--text); color: var(--bg); }
    .wizard-step.done { background: var(--green-verify); color: #fff; }
    .wizard-step-num {
      display: inline-block; width: 20px; height: 20px; line-height: 20px;
      text-align: center; border: 2px solid currentColor; margin-right: 0.3rem;
      font-size: 0.6rem;
    }

    .wizard-panel { display: none; }
    .wizard-panel.active { display: block; }

    .assistant-form .form-group { margin-bottom: 1.25rem; }
    .assistant-form label {
      display: block; font-family: var(--font-mono); font-size: 0.75rem;
      font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em;
      margin-bottom: 0.4rem; color: var(--text);
    }
    .assistant-form .input {
      width: 100%; padding: 0.65rem 0.85rem;
      border: 2px solid var(--border-heavy); background: var(--bg-card);
      font-family: var(--font-mono); font-size: 0.85rem; color: var(--text);
    }
    .assistant-form .input:focus { outline: none; border-color: var(--green-verify); }
    .assistant-form .input::placeholder { color: var(--text-muted); }
    .assistant-form textarea.input { min-height: 80px; resize: vertical; font-family: var(--font-sans); }

    .emoji-grid {
      display: grid; grid-template-columns: repeat(6, 1fr); gap: 0.5rem;
    }
    .emoji-option {
      display: flex; align-items: center; justify-content: center;
      font-size: 1.5rem; padding: 0.6rem; border: 2px solid var(--border);
      background: var(--bg-card); cursor: pointer; transition: border-color 0.2s;
    }
    .emoji-option:hover { border-color: var(--border-heavy); }
    .emoji-option.selected { border-color: var(--green-verify); background: rgba(34,197,94,0.05); }

    .next-btn {
      width: 100%; padding: 0.85rem; border: none;
      background: var(--accent); color: #fff;
      font-family: var(--font-mono); font-size: 0.9rem; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.08em;
      cursor: pointer; transition: background 0.2s;
    }
    .next-btn:hover { background: var(--accent-hover); }
    .next-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .create-btn {
      width: 100%; padding: 0.85rem; border: none;
      background: var(--green-verify); color: #fff;
      font-family: var(--font-mono); font-size: 0.9rem; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.08em;
      cursor: pointer; transition: background 0.2s;
    }
    .create-btn:hover { background: #1aab4d; }
    .create-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .skills-heading {
      font-family: var(--font-mono); font-size: 0.85rem; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.08em;
      margin-bottom: 1rem; color: var(--text);
    }
    .skills-grid {
      display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem;
      margin-bottom: 1.25rem;
    }
    .skill-card {
      border: 2px solid var(--border); padding: 1rem;
      background: var(--bg-card); transition: border-color 0.2s;
    }
    .skill-card.enabled { border-color: var(--green-verify); }
    .skill-card-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 0.5rem;
    }
    .skill-card-name {
      font-family: var(--font-mono); font-size: 0.8rem; font-weight: 600;
      display: flex; align-items: center; gap: 0.4rem;
    }
    .skill-card-icon { font-size: 1rem; }
    .skill-card-desc {
      font-size: 0.8rem; color: var(--text-secondary); line-height: 1.4;
    }
    .skill-toggle {
      position: relative; width: 36px; height: 20px;
      background: var(--border); cursor: pointer;
      flex-shrink: 0;
    }
    .skill-toggle.on { background: var(--green-verify); }
    .skill-toggle-knob {
      position: absolute; top: 2px; left: 2px;
      width: 16px; height: 16px; background: #fff;
      transition: left 0.2s;
    }
    .skill-toggle.on .skill-toggle-knob { left: 18px; }
    .skills-note {
      font-family: var(--font-mono); font-size: 0.7rem; color: var(--text-muted);
      margin-bottom: 1.25rem;
    }
    .skills-loading {
      text-align: center; padding: 2rem;
      font-family: var(--font-mono); font-size: 0.8rem; color: var(--text-muted);
    }

    .key-display {
      border: 2px solid var(--border-heavy); padding: 1.25rem;
      margin-bottom: 1.25rem;
    }
    .key-label {
      font-family: var(--font-mono); font-size: 0.7rem; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.1em; color: var(--text-secondary);
      margin-bottom: 0.4rem;
    }
    .key-value {
      font-family: var(--font-mono); font-size: 0.75rem; word-break: break-all;
      background: var(--bg-card); padding: 0.6rem 0.75rem; border: 1px solid var(--border);
      line-height: 1.5; position: relative;
    }
    .key-copy {
      position: absolute; top: 0.4rem; right: 0.4rem;
      background: var(--border-heavy); color: #fff; border: none;
      font-family: var(--font-mono); font-size: 0.65rem; padding: 0.2rem 0.5rem;
      cursor: pointer;
    }

    .key-warning {
      border: 2px solid var(--red); padding: 1rem; margin-bottom: 1.25rem;
      font-family: var(--font-mono); font-size: 0.8rem; color: var(--red);
      line-height: 1.5;
    }

    .key-download {
      width: 100%; padding: 0.7rem; border: 2px solid var(--border-heavy);
      background: var(--bg-card); color: var(--text);
      font-family: var(--font-mono); font-size: 0.8rem; font-weight: 600;
      cursor: pointer; text-align: center; margin-bottom: 1.25rem;
      transition: border-color 0.2s;
    }
    .key-download:hover { border-color: var(--green-verify); }

    .confirm-btn {
      width: 100%; padding: 0.85rem; border: none;
      background: var(--green-verify); color: #fff;
      font-family: var(--font-mono); font-size: 0.9rem; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.08em;
      cursor: pointer; transition: background 0.2s;
      margin-bottom: 1.25rem;
    }
    .confirm-btn:hover { background: #1aab4d; }

    .success-card {
      border: 2px solid var(--green-verify); padding: 1.5rem;
      margin-bottom: 1.25rem;
    }
    .success-title {
      font-family: var(--font-mono); font-size: 0.85rem; font-weight: 600;
      color: var(--green-verify); text-transform: uppercase; letter-spacing: 0.1em;
      margin-bottom: 0.75rem;
    }
    .success-detail {
      font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.4rem;
    }
    .success-detail strong { color: var(--text); }

    .next-steps {
      border: 2px solid var(--border-heavy); padding: 1.25rem;
      margin-bottom: 1.25rem; display: none;
    }
    .next-steps-title {
      font-family: var(--font-mono); font-size: 0.75rem; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.1em; color: var(--accent);
      margin-bottom: 0.75rem;
    }
    .next-steps ul {
      list-style: none; padding: 0; margin: 0;
      font-size: 0.85rem; color: var(--text-secondary);
    }
    .next-steps li {
      padding: 0.4rem 0; border-bottom: 1px solid var(--border);
      padding-left: 1.25rem; position: relative;
    }
    .next-steps li::before {
      content: "\2014"; position: absolute; left: 0; color: var(--border);
    }
    .next-steps li:last-child { border-bottom: none; }

    .goto-btn {
      display: block; width: 100%; padding: 0.85rem; border: 2px solid var(--border-heavy);
      background: var(--text); color: var(--bg);
      font-family: var(--font-mono); font-size: 0.9rem; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.08em;
      cursor: pointer; text-align: center; text-decoration: none;
      transition: all 0.2s; display: none;
    }
    .goto-btn:hover { background: var(--accent); border-color: var(--accent); color: #fff; }

    .login-gate {
      text-align: center; padding: 3rem 1rem;
      border: 2px solid var(--border-heavy);
    }
    .login-gate-title {
      font-family: var(--font-mono); font-size: 0.85rem; font-weight: 600;
      text-transform: uppercase; letter-spacing: 0.1em;
      margin-bottom: 1rem;
    }
    .login-gate-desc {
      font-size: 0.9rem; color: var(--text-secondary);
      margin-bottom: 1.5rem; max-width: 400px; margin-left: auto; margin-right: auto;
    }
    .login-gate-btn {
      padding: 0.7rem 2rem; border: 2px solid var(--border-heavy);
      background: var(--bg-card); color: var(--text);
      font-family: var(--font-mono); font-size: 0.8rem; font-weight: 600;
      cursor: pointer; transition: border-color 0.2s;
    }
    .login-gate-btn:hover { border-color: var(--green-verify); }

    .error-msg {
      border: 2px solid var(--red); padding: 0.75rem 1rem;
      font-family: var(--font-mono); font-size: 0.8rem; color: var(--red);
      margin-bottom: 1rem; display: none;
    }

    @media (max-width: 768px) {
      .wizard-steps { flex-direction: column; }
      .wizard-step { border-right: none; border-bottom: 2px solid var(--border-heavy); }
      .wizard-step:last-child { border-bottom: none; }
      .skills-grid { grid-template-columns: 1fr; }
      .emoji-grid { grid-template-columns: repeat(4, 1fr); }
    }
  </style>
</head>
<body>
  <div class="site-container">
    <header class="site-header">
      <a href="/" class="site-logo"><img src="/claw-icon.svg" alt="" class="site-logo-icon">SELFCLAW</a>
      <button class="nav-toggle" aria-label="Menu">&equiv;</button>
      <nav class="site-nav">
        <a href="/verify" class="nav-link">VERIFY</a>
        <a href="/registry" class="nav-link" data-gate style="display:none">AGENTS</a>
        <a href="/dashboard" class="nav-link" data-gate style="display:none">DASHBOARD</a>
        <a href="/economy" class="nav-link">ECONOMY</a>
        <a href="/developers" class="nav-link">DOCS</a>
        <a href="/guide" class="nav-link">GUIDE</a>
        <a href="/whitepaper" class="nav-link">WHITEPAPER</a>
        <a href="/manifesto" class="nav-link">\\\</a>
      </nav>
    </header>
  </div>

  <div class="create-page">
    <section class="hero" style="padding: 3rem 0 var(--space-lg);">
      <div class="hero-label">Personal Assistant</div>
      <h1>Create your assistant</h1>
      <p class="hero-sub">A lightweight AI agent that runs on SelfClaw's infrastructure. No coding required &mdash; just pick a name and choose what it should do.</p>
    </section>

    <div id="login-gate" class="login-gate" style="display:none;">
      <div class="login-gate-title">Passport Required</div>
      <div class="login-gate-desc">You need to be logged in with your Self.xyz passport to create an assistant. Your assistant will be linked to your verified identity.</div>
      <button class="login-gate-btn" onclick="window.selfclawAuth && window.selfclawAuth.openLogin()">Login with Self</button>
    </div>

    <div id="wizard-container" style="display:none;">
      <div class="wizard-steps">
        <div class="wizard-step active" id="ws-1"><span class="wizard-step-num">1</span>Identity</div>
        <div class="wizard-step" id="ws-2"><span class="wizard-step-num">2</span>Interests</div>
        <div class="wizard-step" id="ws-3"><span class="wizard-step-num">3</span>Skills</div>
        <div class="wizard-step" id="ws-4"><span class="wizard-step-num">4</span>Done</div>
      </div>

      <div class="wizard-panel active" id="panel-identity">
        <div class="assistant-form">
          <div class="form-group">
            <label for="assistant-name">Assistant Name</label>
            <input type="text" id="assistant-name" class="input" placeholder="my-assistant" maxlength="24">
          </div>

          <div class="form-group">
            <label>Emoji</label>
            <div class="emoji-grid" id="emoji-grid"></div>
          </div>

          <div class="form-group">
            <label for="assistant-desc">Description <span style="font-weight:400;text-transform:none;letter-spacing:0;color:var(--text-muted);">(optional)</span></label>
            <textarea id="assistant-desc" class="input" placeholder="What should your assistant focus on?"></textarea>
          </div>

          <div class="error-msg" id="identity-error"></div>

          <button class="next-btn" id="next-btn" onclick="goToSkills()">Next</button>
        </div>
      </div>

      <div class="wizard-panel" id="panel-interests">
        <div class="skills-heading">Tell your assistant about you</div>
        <div style="font-size:0.85rem;color:var(--text-secondary);margin-bottom:1.5rem;">These help your assistant personalize research, news, and content for you. All optional.</div>

        <div class="assistant-form">
          <div class="form-group">
            <label for="interests-input">Interests <span style="font-weight:400;text-transform:none;letter-spacing:0;color:var(--text-muted);">(comma-separated)</span></label>
            <input type="text" id="interests-input" class="input" placeholder="DeFi, AI agents, Celo, NFTs, DAOs...">
          </div>

          <div class="form-group">
            <label for="topics-input">Topics to Watch <span style="font-weight:400;text-transform:none;letter-spacing:0;color:var(--text-muted);">(keywords for news)</span></label>
            <input type="text" id="topics-input" class="input" placeholder="Uniswap V4, Self.xyz, agent economy...">
          </div>

          <div class="form-group">
            <label for="context-input">Personal Context <span style="font-weight:400;text-transform:none;letter-spacing:0;color:var(--text-muted);">(tell your assistant about your goals)</span></label>
            <textarea id="context-input" class="input" placeholder="I'm building an agent swarm for DeFi trading..." maxlength="1000" style="min-height:80px;"></textarea>
          </div>

          <div class="form-group">
            <label>Social Handles <span style="font-weight:400;text-transform:none;letter-spacing:0;color:var(--text-muted);">(for content drafts)</span></label>
            <div style="display:grid;grid-template-columns:1fr 1fr;gap:0.75rem;">
              <input type="text" id="social-twitter" class="input" placeholder="@handle (X/Twitter)">
              <input type="text" id="social-telegram" class="input" placeholder="@handle (Telegram)">
            </div>
          </div>

          <div style="display:flex;gap:0.75rem;">
            <button class="next-btn" style="background:var(--bg-card);color:var(--text);border:2px solid var(--border-heavy);flex:0;" onclick="setStep(1)">Back</button>
            <button class="next-btn" id="interests-next-btn" onclick="goToSkillsFromInterests()">Next</button>
          </div>
        </div>
      </div>

      <div class="wizard-panel" id="panel-skills">
        <div class="skills-heading">Choose what your assistant can do</div>
        <div id="skills-container">
          <div class="skills-loading">Loading skills...</div>
        </div>
        <div class="skills-note">You can change these anytime from your dashboard. <a href="/skill-market" style="color:var(--accent);">Browse the Skill Market</a> for community-made skills.</div>
        <div class="error-msg" id="skills-error"></div>
        <button class="create-btn" id="create-assistant-btn" onclick="createAssistant()">Create Assistant</button>
      </div>

      <div class="wizard-panel" id="panel-done">
        <div class="success-card">
          <div class="success-title">Assistant Created</div>
          <div class="success-detail"><strong>Name:</strong> <span id="done-emoji"></span> <span id="done-name"></span></div>
        </div>

        <div class="key-warning">
          SAVE YOUR PRIVATE KEY NOW. It will never be shown again. SelfClaw does not store private keys.
        </div>

        <div class="key-display">
          <div class="key-label">Public Key</div>
          <div class="key-value" id="public-key-value">
            <button class="key-copy" onclick="copyKey('public-key-value')">COPY</button>
            <span id="public-key-text"></span>
          </div>
        </div>

        <div class="key-display">
          <div class="key-label">Private Key</div>
          <div class="key-value" id="private-key-value" style="border-color: var(--red);">
            <button class="key-copy" onclick="copyKey('private-key-value')">COPY</button>
            <span id="private-key-text"></span>
          </div>
        </div>

        <button class="key-download" onclick="downloadKeys()">Download Keys as JSON</button>

        <button class="confirm-btn" id="confirm-keys-btn" onclick="confirmKeysSaved()">I've saved my keys</button>

        <div class="next-steps" id="next-steps">
          <div class="next-steps-title">What happens next</div>
          <ul>
            <li>Your assistant is now running on SelfClaw</li>
            <li>It will check your wallet every 5 minutes</li>
            <li>It will analyze your economics hourly</li>
            <li>Visit /my-agents to see its activity</li>
          </ul>
        </div>

        <a href="/my-agents" class="goto-btn" id="goto-btn">Go to My Agents</a>
      </div>
    </div>

    <footer class="site-footer">
      <nav class="footer-nav">
        <a href="/">Home</a>
        <a href="/verify">Verify</a>
        <a href="/registry" data-gate-footer style="display:none">Agents</a>
        <a href="/dashboard" data-gate-footer style="display:none">Dashboard</a>
        <a href="/economy">Economy</a>
        <a href="/developers">Docs</a>
        <a href="/whitepaper">Whitepaper</a>
      </nav>
      <div class="footer-meta">
        <span>Powered by <a href="https://self.xyz" target="_blank">Self.xyz</a> zero-knowledge proofs</span>
        <span>Built by <a href="https://zeno.vision" target="_blank" rel="noopener">Zeno</a> &middot; <a href="https://github.com/mbarbosa30/SelfClaw" target="_blank" rel="noopener">GitHub</a> &middot; <a href="https://t.me/+GC2quXBnarw1MzU0" target="_blank" rel="noopener">Telegram</a> &middot; <a href="https://x.com/selfclaw" target="_blank" rel="noopener">X</a></span>
      </div>
    </footer>
  </div>

  <script src="/auth.js"></script>
  <script src="/nav-gate.js"></script>
  <script src="/nav-toggle.js"></script>
  <script>
    var selectedEmoji = '';
    var skillsData = [];
    var enabledSkills = {};
    var createdAgent = null;

    var EMOJIS = ['\u{1F916}', '\u{1F9E0}', '\u{1F4A1}', '\u{1F50D}', '\u{1F4CA}', '\u{1F6E1}\uFE0F', '\u{1F680}', '\u{1F3AF}', '\u{1F4B0}', '\u26A1', '\u{1F310}', '\u{1F91D}'];

    function esc(s) { if (!s) return ''; var d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

    function initEmojis() {
      var grid = document.getElementById('emoji-grid');
      var html = '';
      for (var i = 0; i < EMOJIS.length; i++) {
        html += '<div class="emoji-option" data-emoji="' + EMOJIS[i] + '" onclick="selectEmoji(this)">' + EMOJIS[i] + '</div>';
      }
      grid.innerHTML = html;
      var first = grid.querySelector('.emoji-option');
      if (first) { first.classList.add('selected'); selectedEmoji = first.getAttribute('data-emoji'); }
    }

    function selectEmoji(el) {
      var all = document.querySelectorAll('.emoji-option');
      for (var i = 0; i < all.length; i++) all[i].classList.remove('selected');
      el.classList.add('selected');
      selectedEmoji = el.getAttribute('data-emoji');
    }

    function goToSkills() {
      var name = document.getElementById('assistant-name').value.trim();
      var errEl = document.getElementById('identity-error');
      if (!name) {
        errEl.textContent = 'Please enter a name for your assistant.';
        errEl.style.display = '';
        return;
      }
      if (name.length > 24) {
        errEl.textContent = 'Name must be 24 characters or less.';
        errEl.style.display = '';
        return;
      }
      errEl.style.display = 'none';
      setStep(2);
    }

    function goToSkillsFromInterests() {
      setStep(3);
      loadSkills();
    }

    function setStep(step) {
      var panels = ['panel-identity', 'panel-interests', 'panel-skills', 'panel-done'];
      var steps = ['ws-1', 'ws-2', 'ws-3', 'ws-4'];
      for (var i = 0; i < panels.length; i++) {
        document.getElementById(panels[i]).classList.remove('active');
        document.getElementById(steps[i]).classList.remove('active', 'done');
      }
      for (var i = 0; i < step - 1; i++) {
        document.getElementById(steps[i]).classList.add('done');
      }
      document.getElementById(steps[step - 1]).classList.add('active');
      document.getElementById(panels[step - 1]).classList.add('active');
    }

    async function loadSkills() {
      var container = document.getElementById('skills-container');
      try {
        var res = await fetch('/api/selfclaw/v1/hosted-agents/skills');
        if (!res.ok) throw new Error('Failed to load skills');
        skillsData = await res.json();
        renderSkills();
      } catch (err) {
        container.innerHTML = '<div class="skills-loading">Failed to load skills. Please try again.</div>';
      }
    }

    function renderSkills() {
      var container = document.getElementById('skills-container');
      if (!skillsData || !skillsData.length) {
        container.innerHTML = '<div class="skills-loading">No skills available.</div>';
        return;
      }
      var html = '<div class="skills-grid">';
      for (var i = 0; i < skillsData.length; i++) {
        var skill = skillsData[i];
        var id = skill.id || skill.slug || skill.name;
        var isDefault = (id === 'wallet-monitor' || id === 'economics-tracker');
        if (isDefault) enabledSkills[id] = true;
        var enabledClass = (isDefault || enabledSkills[id]) ? ' enabled' : '';
        var toggleClass = (isDefault || enabledSkills[id]) ? ' on' : '';
        html += '<div class="skill-card' + enabledClass + '" id="skill-card-' + esc(id) + '">';
        html += '<div class="skill-card-header">';
        html += '<div class="skill-card-name"><span class="skill-card-icon">' + esc(skill.icon || '') + '</span> ' + esc(skill.name || id) + '</div>';
        html += '<div class="skill-toggle' + toggleClass + '" id="toggle-' + esc(id) + '" onclick="toggleSkill(\'' + esc(id) + '\')">';
        html += '<div class="skill-toggle-knob"></div>';
        html += '</div>';
        html += '</div>';
        html += '<div class="skill-card-desc">' + esc(skill.description || '') + '</div>';
        html += '</div>';
      }
      html += '</div>';
      container.innerHTML = html;
    }

    function toggleSkill(id) {
      enabledSkills[id] = !enabledSkills[id];
      var toggle = document.getElementById('toggle-' + id);
      var card = document.getElementById('skill-card-' + id);
      if (enabledSkills[id]) {
        toggle.classList.add('on');
        card.classList.add('enabled');
      } else {
        toggle.classList.remove('on');
        card.classList.remove('enabled');
      }
    }

    async function createAssistant() {
      var btn = document.getElementById('create-assistant-btn');
      var errEl = document.getElementById('skills-error');
      btn.disabled = true;
      btn.textContent = 'Creating...';
      errEl.style.display = 'none';

      var name = document.getElementById('assistant-name').value.trim();
      var desc = document.getElementById('assistant-desc').value.trim();
      var skills = [];
      for (var key in enabledSkills) {
        if (enabledSkills[key]) skills.push(key);
      }

      var interestsRaw = document.getElementById('interests-input').value.trim();
      var topicsRaw = document.getElementById('topics-input').value.trim();
      var contextVal = document.getElementById('context-input').value.trim();
      var twitterVal = document.getElementById('social-twitter').value.trim().replace(/^@/, '');
      var telegramVal = document.getElementById('social-telegram').value.trim().replace(/^@/, '');

      var interestsArr = interestsRaw ? interestsRaw.split(',').map(function(s) { return s.trim(); }).filter(Boolean) : [];
      var topicsArr = topicsRaw ? topicsRaw.split(',').map(function(s) { return s.trim(); }).filter(Boolean) : [];
      var socialObj = {};
      if (twitterVal) socialObj.twitter = twitterVal;
      if (telegramVal) socialObj.telegram = telegramVal;

      try {
        var res = await fetch('/api/selfclaw/v1/hosted-agents', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: name,
            emoji: selectedEmoji,
            description: desc,
            enabledSkills: skills,
            interests: interestsArr,
            topicsToWatch: topicsArr,
            personalContext: contextVal || null,
            socialHandles: socialObj
          })
        });
        if (!res.ok) {
          var err = await res.json().catch(function() { return {}; });
          throw new Error(err.error || err.message || 'Failed to create assistant');
        }
        createdAgent = await res.json();
        showDone();
      } catch (err) {
        errEl.textContent = err.message;
        errEl.style.display = '';
        btn.disabled = false;
        btn.textContent = 'Create Assistant';
      }
    }

    function showDone() {
      setStep(4);
      document.getElementById('done-name').textContent = createdAgent.name || '';
      document.getElementById('done-emoji').textContent = createdAgent.emoji || selectedEmoji || '';

      var creds = createdAgent.credentials || {};
      document.getElementById('public-key-text').textContent = creds.publicKey || '';
      document.getElementById('private-key-text').textContent = creds.privateKey || '';
    }

    function copyKey(containerId) {
      var el = document.getElementById(containerId);
      var span = el.querySelector('span');
      if (!span) return;
      var text = span.textContent;
      navigator.clipboard.writeText(text).then(function() {
        var btn = el.querySelector('.key-copy');
        btn.textContent = 'COPIED';
        setTimeout(function() { btn.textContent = 'COPY'; }, 1500);
      });
    }

    function downloadKeys() {
      if (!createdAgent) return;
      var creds = createdAgent.credentials || {};
      var data = {
        name: createdAgent.name || '',
        emoji: createdAgent.emoji || selectedEmoji || '',
        publicKey: creds.publicKey || '',
        privateKey: creds.privateKey || '',
        createdAt: new Date().toISOString()
      };
      var blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = (createdAgent.name || 'assistant') + '-keys.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    function confirmKeysSaved() {
      document.getElementById('confirm-keys-btn').style.display = 'none';
      document.getElementById('next-steps').style.display = '';
      document.getElementById('goto-btn').style.display = '';
    }

    window.onAuthLogin = function(user) {
      document.getElementById('login-gate').style.display = 'none';
      document.getElementById('wizard-container').style.display = '';
    };

    window.onAuthLogout = function() {
      document.getElementById('login-gate').style.display = '';
      document.getElementById('wizard-container').style.display = 'none';
    };

    function initPage() {
      initEmojis();
      if (window.selfclawAuth) {
        window.selfclawAuth.onReady(function(user) {
          if (user) {
            document.getElementById('login-gate').style.display = 'none';
            document.getElementById('wizard-container').style.display = '';
          } else {
            document.getElementById('login-gate').style.display = '';
            document.getElementById('wizard-container').style.display = 'none';
          }
        });
      } else {
        fetch('/api/auth/status').then(function(r) { return r.json(); }).then(function(data) {
          if (data && data.loggedIn) {
            document.getElementById('login-gate').style.display = 'none';
            document.getElementById('wizard-container').style.display = '';
          } else {
            document.getElementById('login-gate').style.display = '';
          }
        }).catch(function() {
          document.getElementById('login-gate').style.display = '';
        });
      }
    }

    initPage();
  </script>
</body>
</html>